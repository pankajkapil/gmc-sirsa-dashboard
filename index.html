<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMC Sirsa Medical College - Project Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: #003d82; color: white; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 30px; }
        header h1 { font-size: 28px; margin-bottom: 5px; }
        header p { font-size: 14px; opacity: 0.9; }
        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .kpi-card h3 { color: #555; font-size: 14px; margin-bottom: 10px; }
        .kpi-card .value { font-size: 28px; font-weight: bold; color: #003d82; }
        .kpi-card .unit { font-size: 12px; color: #999; margin-top: 5px; }
        .rag-status { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .rag-item { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
        .rag-item h4 { font-size: 14px; margin-bottom: 10px; }
        .rag-badge { display: inline-block; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .rag-green { background: #28a745; color: white; }
        .rag-amber { background: #ffc107; color: black; }
        .rag-red { background: #dc3545; color: white; }
        .section { background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .section h2 { color: #003d82; margin-bottom: 20px; border-bottom: 2px solid #003d82; padding-bottom: 10px; }
        .building-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .building-card { background: #f9f9f9; padding: 15px; border-left: 4px solid #003d82; border-radius: 4px; }
        .building-card h3 { font-size: 14px; color: #003d82; margin-bottom: 10px; }
        .progress-bar { background: #e0e0e0; height: 25px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(to right, #28a745, #20c997); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold; }
        .refresh-time { text-align: center; color: #999; font-size: 12px; margin-top: 20px; }
        .financial-table { width: 100%; border-collapse: collapse; }
        .financial-table th { background: #003d82; color: white; padding: 12px; text-align: left; }
        .financial-table td { padding: 12px; border-bottom: 1px solid #ddd; }
        .financial-table tr:hover { background: #f9f9f9; }
             .monthly-photos { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
     .photo-month { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
     .photo-month h4 { color: #003d82; font-size: 14px; margin: 10px 0 5px 0; }
     .photo-month img { width: 100%; height: 120px; object-fit: cover; border-radius: 4px; }
     .photo-month p { color: #999; font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GMC Sirsa Medical College Construction Project</h1>
            <p>Project Management Dashboard | Tender Clause 2.5(xii) Compliant</p>
        </header>
        
        <div class="kpi-container">
            <div class="kpi-card">
                <h3>Physical Progress</h3>
                <div class="value" id="physicalProgress">26.87%</div>
            </div>
            <div class="kpi-card">
                <h3>Financial Progress</h3>
                <div class="value" id="financialProgress">24.26%</div>
            </div>
            <div class="kpi-card">
                <h3>Total Project Cost</h3>
                <div class="value" id="totalCost">₹832 Cr</div>
            </div>
            <div class="kpi-card">
                <h3>Funds Released</h3>
                <div class="value" id="fundsReleased">₹134.90 Cr</div>
            </div>
        </div>
        
        <div class="section">
            <h2>Financial Status</h2>
            <table class="financial-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total Project Cost</td>
                        <td id="financialTotalCost">₹832 Crores</td>
                    </tr>
                    <tr>
                        <td>Financial Progress</td>
                        <td id="financialProgressAmount">₹201.84 Crores (24.26%)</td>
                    </tr>
                    <tr>
                        <td>Funds Released</td>
                        <td id="financialFundsReleased">₹134.90 Crores</td>
                    </tr>
                    <tr>
                        <td>Funding Gap</td>
                        <td id="financialFundingGap">₹67.10 Crores</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>RAG Status</h2>
            <div class="rag-status">
                <div class="rag-item">
                    <h4>Quality</h4>
                    <div class="rag-badge rag-green" id="ragQuality">GREEN</div>
                </div>
                <div class="rag-item">
                    <h4>Timeline</h4>
                    <div class="rag-badge rag-green" id="ragTimeline">GREEN</div>
                </div>
                <div class="rag-item">
                    <h4>Cost</h4>
                    <div class="rag-badge rag-amber" id="ragCost">AMBER</div>
                </div>
                <div class="rag-item">
                    <h4>Safety</h4>
                    <div class="rag-badge rag-green" id="ragSafety">GREEN</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Physical Progress by Building (12 Buildings)</h2>
            <div class="building-grid" id="buildingsContainer"></div>
        </div>
             <div class="section">
     <h2>Monthly Progress Photos (12 Months)</h2>
     <div class="monthly-photos" id="monthlyPhotosContainer"></div>
     </div>

        
        <div class="refresh-time">
            <p>Last Updated: <span id="lastUpdated">Loading...</span> | Auto-refresh every 5 seconds</p>
        </div>
    </div>
    
    <script>
        // Default data with correct building names
        const DEFAULT_DATA = {
            projectSummary: {
                physicalProgress: 26.87,
                financialProgress: 24.26,
                totalProjectCost: "832 Cr",
                financialProgressAmount: "201.84 Cr",
                totalFundsReleased: "134.90 Cr",
                fundingGap: "67.10 Cr"
            },
            ragStatus: {
                quality: "GREEN",
                timeline: "GREEN",
                cost: "AMBER",
                safety: "GREEN"
            },
            physicalProgress: {
                "External Development/Road": 15,
                "Junior & Senior Resident (S+12)": 28,
                "Boys Hostel (G+8)": 22,
                "Nursing Girls Hostel (G+8)": 25,
                "Girls Hostel (G+6)": 18,
                "Hospital Block (B+G+7)": 32,
                "Service Block": 20,
                "Vishram Sarai (G+2)": 30,
                "Medical College (B+G+5)": 29,
                "Director & MS Residence (G+1)": 35,
                "Paramedical Block (B+G+6)": 24,
                "Common Basement": 26
            },
            lastUpdated: "2025-11-30"
        };
        
        function loadData() {
                    console.log('loadData called at:', new Date());
            try {
                const savedData = localStorage.getItem('dashboardData');
                        console.log('savedData from localStorage:', savedData);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    updateDashboard(data);
                } else {
                    updateDashboard(DEFAULT_DATA);
                }
            } catch (e) {
                console.error('Error loading data:', e);
                updateDashboard(DEFAULT_DATA);
            }
        }
        
        function updateDashboard(data) {
                    console.log('updateDashboard called with data:', data);
            const summary = data.projectSummary || DEFAULT_DATA.projectSummary;
            const rag = data.ragStatus || DEFAULT_DATA.ragStatus;
            const buildings = data.physicalProgress || DEFAULT_DATA.physicalProgress;
            
            // Update KPIs
            document.getElementById('physicalProgress').textContent = summary.physicalProgress + '%';
            document.getElementById('financialProgress').textContent = summary.financialProgress + '%';
            document.getElementById('totalCost').textContent = '₹' + summary.totalProjectCost;
            document.getElementById('fundsReleased').textContent = '₹' + summary.totalFundsReleased;
            
            // Update Financial Table
            document.getElementById('financialTotalCost').textContent = '₹' + summary.totalProjectCost;
            document.getElementById('financialProgressAmount').textContent = '₹' + summary.financialProgressAmount + ' (' + summary.financialProgress + '%)';
            document.getElementById('financialFundsReleased').textContent = '₹' + summary.totalFundsReleased;
            document.getElementById('financialFundingGap').textContent = '₹' + summary.fundingGap;
            
            // Update RAG Status
            updateRAGStatus('ragQuality', rag.quality);
            updateRAGStatus('ragTimeline', rag.timeline);
            updateRAGStatus('ragCost', rag.cost);
            updateRAGStatus('ragSafety', rag.safety);
            
            // Update Buildings
            renderBuildings(buildings);
            
            // Update timestamp
            document.getElementById('lastUpdated').textContent = data.lastUpdated || new Date().toLocaleDateString();
        }
        
        function updateRAGStatus(elementId, status) {
            const element = document.getElementById(elementId);
            element.textContent = status;
            element.className = 'rag-badge';
            if (status === 'GREEN') element.classList.add('rag-green');
            else if (status === 'AMBER') element.classList.add('rag-amber');
            else if (status === 'RED') element.classList.add('rag-red');
        }
        
        function renderBuildings(buildings) {
            const container = document.getElementById('buildingsContainer');
            container.innerHTML = '';
            
            for (const [building, progress] of Object.entries(buildings)) {
                const card = document.createElement('div');
                card.className = 'building-card';
                card.innerHTML = `
                    <h3>${building}</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%;">${progress}%</div>
                    </div>
                `;
                container.appendChild(card);
            }
        }
        
        // Load data on page load
        window.addEventListener('load', loadData);
        
        // Auto-refresh every 5 seconds
        setInterval(() => { loadData(); renderMonthlyPhotos(); }, 5000);         
 // Monthly Photos Management
 const MONTHS = ['November', 'December', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'];
 
function renderMonthlyPhotos() {
    const container = document.getElementById('monthlyPhotosContainer');
    const savedPhotos = JSON.parse(localStorage.getItem('monthlyPhotos')) || {};
    container.innerHTML = '';

    MONTHS.forEach((month, index) => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo-month';
        
        // Handle photo array (new structure) or fallback to single photo (legacy)
        const monthPhotos = Array.isArray(savedPhotos[month]) ? savedPhotos[month] : (savedPhotos[month] ? [savedPhotos[month]] : []);
        
        let photoHtml = `<h4>${month}</h4>`;
        
        if (monthPhotos.length > 0) {
            photoHtml += '<div class="photo-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">';
            monthPhotos.forEach((photoUrl, photoIndex) => {
                if (photoUrl) {
                    photoHtml += `<img src="${photoUrl}" alt="${month} photo ${photoIndex + 1}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">`;
                }
            });
            photoHtml += '</div>';
            photoHtml += `<p style="font-size: 12px; color: #999; margin-top: 8px;">${monthPhotos.length} photo(s) uploaded</p>`;
        } else {
            photoHtml += '<p style="color: #999; margin-top: 10px;">No photos uploaded</p>';
        }
        
        photoDiv.innerHTML = photoHtml;
        container.appendChild(photoDiv);
    });
}
 
 // Load photos on page load and on each refresh
 window.addEventListener('load', renderMonthlyPhotos);
        
// Migrate legacy single-photo data to array format
function migratePhotosData() {
    const saved = JSON.parse(localStorage.getItem('monthlyPhotos')) || {};
    let modified = false;
    for (let month in saved) {
        if (saved[month] && !Array.isArray(saved[month]) && typeof saved[month] === 'string') {
            saved[month] = [saved[month]];  // Convert string to array
            modified = true;
        }
    }
    if (modified) {
        localStorage.setItem('monthlyPhotos', JSON.stringify(saved));
    }
}

// Run migration on page load
window.addEventListener('DOMContentLoaded', migratePhotosData);
    </script>
</body>
</html>

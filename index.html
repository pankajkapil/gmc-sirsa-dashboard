<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMC Sirsa Medical College - Project Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: #003d82; color: white; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 20px; }
        header h1 { font-size: 28px; margin-bottom: 5px; }
        header p { font-size: 14px; opacity: 0.9; }
        .sync-indicator { display: inline-block; background: #28a745; color: white; padding: 5px 10px; border-radius: 3px; font-size: 12px; margin-top: 10px; }
        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .kpi-card h3 { color: #003d82; font-size: 14px; margin-bottom: 10px; }
        .kpi-value { font-size: 32px; font-weight: bold; color: #003d82; }
        .kpi-unit { font-size: 14px; color: #666; }
        .rag-status { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .badge { display: inline-block; padding: 8px 15px; border-radius: 20px; font-weight: bold; color: white; font-size: 14px; }
        .badge-green { background: #28a745; }
        .badge-amber { background: #ffc107; color: #333; }
        .badge-red { background: #dc3545; }
        .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section h2 { color: #003d82; margin-bottom: 20px; border-bottom: 2px solid #003d82; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; }
        table th { background: #003d82; color: white; padding: 12px; text-align: left; }
        table td { padding: 12px; border-bottom: 1px solid #eee; }
        table tr:hover { background: #f9f9f9; }
        .progress-bar { width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: #28a745; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; }
        .photo-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .photo-item { background: #f0f0f0; border-radius: 8px; overflow: hidden; border: 2px solid #ddd; }
        .photo-item img { width: 100%; height: 150px; object-fit: cover; }
        .photo-item p { padding: 10px; text-align: center; font-size: 12px; color: #666; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .last-sync { text-align: right; font-size: 12px; color: #999; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>GMC Sirsa Medical College</h1>
            <p>Construction Project Management Dashboard - Tender Clause 2.5(xii) Compliant</p>
            <div class="sync-indicator" id="syncIndicator">ðŸ”„ Loading Data...</div>
            <div class="last-sync" id="lastSync"></div>
        </header>

        <!-- KPI Cards -->
        <div class="kpi-container" id="kpiContainer">
            <div class="loading">Loading KPI data...</div>
        </div>

        <!-- RAG Status -->
        <div class="section" id="ragSection" style="display:none;">
            <h2>Project Status (RAG)</h2>
            <div class="rag-status" id="ragContainer"></div>
        </div>

        <!-- Physical Progress by Building -->
        <div class="section" id="buildingSection" style="display:none;">
            <h2>Physical Progress by Building (%)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Building Name</th>
                        <th>Progress %</th>
                        <th>Visual</th>
                    </tr>
                </thead>
                <tbody id="buildingTableBody"></tbody>
            </table>
        </div>

        <!-- Financial Status -->
        <div class="section" id="financialSection" style="display:none;">
            <h2>Financial Status</h2>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Amount (Cr)</th>
                    </tr>
                </thead>
                <tbody id="financialTableBody"></tbody>
            </table>
        </div>

        <!-- Quality Assurance -->
        <div class="section" id="qualitySection" style="display:none;">
            <h2>Quality Assurance - Material Testing</h2>
            <table>
                <thead>
                    <tr>
                        <th>Material</th>
                        <th>Samples Tested</th>
                        <th>Passed</th>
                        <th>Pass %</th>
                    </tr>
                </thead>
                <tbody id="qualityTableBody"></tbody>
            </table>
        </div>

        <!-- Photo Gallery -->
        <div class="section" id="photoSection" style="display:none;">
            <h2>Monthly Progress Photos (November 2025)</h2>
            <div class="photo-gallery" id="photoGallery"></div>
        </div>
    </div>

    <script>
        const DATA_URL = 'https://raw.githubusercontent.com/pankajkapil/gmc-sirsa-dashboard/main/data.json';
        let dashboardData = null;

        // Auto-refresh data every 5 seconds to sync with admin panel
        setInterval(loadDashboardData, 5000);

        // Load data on page load
        window.addEventListener('load', loadDashboardData);

        function loadDashboardData() {
            // Try to load from admin's localStorage first (if on same domain)
            const localData = localStorage.getItem('dashboardData');
            if (localData) {
                try {
                    dashboardData = JSON.parse(localData);
                    renderDashboard(dashboardData);
                    updateSyncStatus('Real-Time Sync Active');
                    return;
                } catch (e) {}
            }

            // Otherwise fetch from GitHub
            fetch(DATA_URL)
                .then(response => response.json())
                .then(data => {
                    dashboardData = data;
                    renderDashboard(data);
                    updateSyncStatus('Synced with GitHub');
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    updateSyncStatus('Error loading data');
                });
        }

        function renderDashboard(data) {
            renderKPIs(data.projectSummary);
            renderRAGStatus(data.ragStatus);
            renderBuildingProgress(data.physicalProgress);
            renderFinancial(data.financialStatus);
            renderQuality(data.qualityAssurance);
            renderPhotos(data.photoGallery);
            updateLastSyncTime();
        }

        function renderKPIs(summary) {
            const container = document.getElementById('kpiContainer');
            container.innerHTML = `
                <div class="kpi-card">
                    <h3>Physical Progress</h3>
                    <div class="kpi-value">${summary.physicalProgress}%</div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${summary.physicalProgress}%"></div></div>
                </div>
                <div class="kpi-card">
                    <h3>Financial Progress</h3>
                    <div class="kpi-value">${summary.financialProgress}%</div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${summary.financialProgress}%"></div></div>
                </div>
                <div class="kpi-card">
                    <h3>Funds Released</h3>
                    <div class="kpi-value">${summary.fundsReleased}</div>
                </div>
                <div class="kpi-card">
                    <h3>Funding Gap</h3>
                    <div class="kpi-value" style="color:#dc3545;">${summary.fundingGap}</div>
                </div>
            `;
        }

        function renderRAGStatus(rag) {
            document.getElementById('ragSection').style.display = 'block';
            const container = document.getElementById('ragContainer');
            const badges = {
                'Quality': rag.quality,
                'Timeline': rag.timeline,
                'Cost': rag.cost,
                'Safety': rag.safety
            };
            
            let html = '';
            for (const [label, status] of Object.entries(badges)) {
                const badgeClass = `badge-${status.toLowerCase()}`;
                html += `<div style="text-align:center;"><div class="badge ${badgeClass}">${label}: ${status}</div></div>`;
            }
            container.innerHTML = html;
        }

        function renderBuildingProgress(buildings) {
            document.getElementById('buildingSection').style.display = 'block';
            const tbody = document.getElementById('buildingTableBody');
            let html = '';
            for (const [building, progress] of Object.entries(buildings)) {
                html += `
                    <tr>
                        <td>${building}</td>
                        <td>${progress}%</td>
                        <td><div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div></td>
                    </tr>
                `;
            }
            tbody.innerHTML = html;
        }

        function renderFinancial(financial) {
            document.getElementById('financialSection').style.display = 'block';
            const tbody = document.getElementById('financialTableBody');
            let html = `
                <tr><td>Total Contract Value</td><td>${financial.totalContractValue}</td></tr>
                <tr><td>Released</td><td>${financial.released}</td></tr>
                <tr><td>Pending Release</td><td>${financial.pendingRelease}</td></tr>
                <tr><td>Utilization</td><td>${financial.utilization}</td></tr>
            `;
            tbody.innerHTML = html;
        }

        function renderQuality(quality) {
            document.getElementById('qualitySection').style.display = 'block';
            const tbody = document.getElementById('qualityTableBody');
            let html = '';
            quality.forEach(item => {
                html += `
                    <tr>
                        <td>${item.material}</td>
                        <td>${item.samples}</td>
                        <td>${item.passed}</td>
                        <td>${item.percentage}%</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderPhotos(gallery) {
            const photos = gallery.november2025 || [];
            if (photos.length > 0) {
                document.getElementById('photoSection').style.display = 'block';
                const photoGallery = document.getElementById('photoGallery');
                let html = '';
                photos.forEach((photo, index) => {
                    html += `
                        <div class="photo-item">
                            <img src="${photo.data}" alt="Photo ${index + 1}">
                            <p>${photo.name}</p>
                        </div>
                    `;
                });
                photoGallery.innerHTML = html;
            }
        }

        function updateSyncStatus(message) {
            document.getElementById('syncIndicator').textContent = 'âœ“ ' + message;
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleTimeString();
            document.getElementById('lastSync').textContent = 'Last updated: ' + now;
        }
    </script>
</body>
</html>

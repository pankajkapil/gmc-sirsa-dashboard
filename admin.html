<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GMC Sirsa - Admin</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
    .admin-panel { max-width: 1200px; margin: 20px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #2c3e50; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; color: #2c3e50; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    textarea { resize: vertical; min-height: 100px; }
    button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; }
    button:hover { background: #2980b9; }
    .status-msg { margin-top: 10px; padding: 10px; border-radius: 4px; }
    .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .section { margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media(max-width: 768px) { .two-col { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="admin-panel">
    <h1>GMC Sirsa Dashboard - Admin Panel</h1>
    
    <div class="section">
      <h2>Progress Tracking</h2>
      <div class="two-col">
        <div class="form-group">
          <label>Physical Progress (%)</label>
          <input type="number" id="physicalProgress" min="0" max="100" placeholder="0-100">
        </div>
        <div class="form-group">
          <label>Financial Progress (%)</label>
          <input type="number" id="financialProgress" min="0" max="100" placeholder="0-100">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Financial Details</h2>
      <div class="two-col">
        <div class="form-group">
          <label>Total Project Cost (â‚¹)</label>
          <input type="number" id="totalProjectCost" placeholder="Amount">
        </div>
        <div class="form-group">
          <label>Total Funds Released (â‚¹)</label>
          <input type="number" id="totalFundsReleased" placeholder="Amount">
        </div>
      </div>
      <div class="two-col">
        <div class="form-group">
          <label>Financial Progress (â‚¹)</label>
          <input type="number" id="financialProgressAmount" placeholder="Amount">
        </div>
        <div class="form-group">
          <label>Funding Gap (â‚¹)</label>
          <input type="number" id="fundingGap" placeholder="Amount">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Status Indicators</h2>
      <div class="two-col">
        <div class="form-group">
          <label>Quality Status</label>
          <select id="qualityStatus">
            <option value="GREEN">Green (On Track)</option>
            <option value="YELLOW">Yellow (At Risk)</option>
            <option value="RED">Red (Critical)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Timeline Status</label>
          <select id="timelineStatus">
            <option value="GREEN">Green (On Track)</option>
            <option value="YELLOW">Yellow (At Risk)</option>
            <option value="RED">Red (Critical)</option>
          </select>
        </div>
      </div>
      <div class="two-col">
        <div class="form-group">
          <label>Cost Status</label>
          <select id="costStatus">
            <option value="GREEN">Green (On Track)</option>
            <option value="YELLOW">Yellow (At Risk)</option>
            <option value="RED">Red (Critical)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Safety Status</label>
          <select id="safetyStatus">
            <option value="GREEN">Green (Safe)</option>
            <option value="YELLOW">Yellow (Caution)</option>
            <option value="RED">Red (Unsafe)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Building-wise Progress</h2>
      <div id="buildings-container"></div>
    </div>

    <div>
      <button onclick="saveData()">ðŸ’¾ Save Changes</button>
      <button onclick="location.href='index.html'">ðŸ“Š View Dashboard</button>
    </div>
    
    <div id="status-message" class="status-msg" style="display: none;"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC9eAcBdH0pu4NLVwLT-g_0Gn7Ly2Y5Zxw",
      authDomain: "rudransh-kapil.firebaseapp.com",
      projectId: "rudransh-kapil",
      storageBucket: "rudransh-kapil.appspot.com",
      messagingSenderId: "123456789",
      databaseURL: "https://rudransh-kapil-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const buildings = ['Block A', 'Block B', 'Block C', 'Block D', 'Block E', 'Admin Building'];
    const SYNC_KEY = 'gmc_sirsa_sync_data';

    // Initialize buildings container
    function renderBuildings() {
      const container = document.getElementById('buildings-container');
      container.innerHTML = '<div class="two-col">' + buildings.map(b => {
        const safeId = 'building_' + b.replace(/[^a-zA-Z0-9]/g, '_');
        return `<div class="form-group"><label>${b} Progress (%)</label><input type="number" id="${safeId}" min="0" max="100" placeholder="0-100"></div>`;
      }).join('') + '</div>';
    }

    // Save data to Firebase
    function saveData() {
      const data = {
        physicalProgress: parseInt(document.getElementById('physicalProgress').value) || 0,
        financialProgress: parseInt(document.getElementById('financialProgress').value) || 0,
        totalProjectCost: parseInt(document.getElementById('totalProjectCost').value) || 0,
        totalFundsReleased: parseInt(document.getElementById('totalFundsReleased').value) || 0,
        financialProgressAmount: parseInt(document.getElementById('financialProgressAmount').value) || 0,
        fundingGap: parseInt(document.getElementById('fundingGap').value) || 0,
        qualityStatus: document.getElementById('qualityStatus').value,
        timelineStatus: document.getElementById('timelineStatus').value,
        costStatus: document.getElementById('costStatus').value,
        safetyStatus: document.getElementById('safetyStatus').value,
        lastUpdated: new Date().toLocaleString('en-IN')
      };

      buildings.forEach(building => {
        const safeId = 'building_' + building.replace(/[^a-zA-Z0-9]/g, '_');
        data['building_' + building] = parseInt(document.getElementById(safeId).value) || 0;
      });

      // Save to localStorage
      localStorage.setItem(SYNC_KEY, JSON.stringify(data));

      // Sync to Firebase
      const syncRef = ref(db, 'dashboard/current');
      set(syncRef, data).then(() => {
        showMessage('âœ… Data synced to Firebase successfully!');
      }).catch(error => {
        showMessage('âŒ Error syncing to Firebase: ' + error.message);
      });
    }

    // Load data from localStorage/Firebase
    function loadData() {
      const stored = localStorage.getItem(SYNC_KEY);
      if (!stored) return;
      
      const data = JSON.parse(stored);
      document.getElementById('physicalProgress').value = data.physicalProgress || '';
      document.getElementById('financialProgress').value = data.financialProgress || '';
      document.getElementById('totalProjectCost').value = data.totalProjectCost || '';
      document.getElementById('totalFundsReleased').value = data.totalFundsReleased || '';
      document.getElementById('financialProgressAmount').value = data.financialProgressAmount || '';
      document.getElementById('fundingGap').value = data.fundingGap || '';
      document.getElementById('qualityStatus').value = data.qualityStatus || 'GREEN';
      document.getElementById('timelineStatus').value = data.timelineStatus || 'GREEN';
      document.getElementById('costStatus').value = data.costStatus || 'GREEN';
      document.getElementById('safetyStatus').value = data.safetyStatus || 'GREEN';
      
      buildings.forEach(building => {
        const safeId = 'building_' + building.replace(/[^a-zA-Z0-9]/g, '_');
        const value = data['building_' + building];
        if (document.getElementById(safeId)) {
          document.getElementById(safeId).value = value || '';
        }
      });
    }

    // Show status message
    function showMessage(msg) {
      const el = document.getElementById('status-message');
      el.textContent = msg;
      el.className = 'status-msg status-success';
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 3000);
    }

    // Listen to Firebase changes
    function listenToFirebase() {
      const syncRef = ref(db, 'dashboard/current');
      onValue(syncRef, (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          localStorage.setItem(SYNC_KEY, JSON.stringify(data));
          loadData();
        }
      });
    }

    // Initialize on page load
    window.addEventListener('load', () => {
      renderBuildings();
      loadData();
      listenToFirebase();
    });

    // Expose functions to global scope
    window.saveData = saveData;
  </script>
</body>
</html>

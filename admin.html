<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>GMC Sirsa - Admin</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial; background: #f0f0f0; }
.admin-panel { max-width: 1200px; margin: 20px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
h1, h2 { color: #333; margin-bottom: 20px; }
.logout-btn { float: right; padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: Arial; }
.save-btn { padding: 12px 30px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; }
.save-btn:hover { background: #218838; }
.save-btn:disabled { background: #ccc; cursor: not-allowed; }
.status-msg { margin-top: 10px; padding: 10px; border-radius: 4px; font-weight: bold; }
.status-success { background: #d4edda; color: #155724; }
.status-error { background: #f8d7da; color: #721c24; }
.section { background: #f9f9f9; padding: 20px; margin-bottom: 20px; border-left: 4px solid #007bff; border-radius: 4px; }
#login-page { display: block; }
#admin-page { display: none; }
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.status-badge { display: inline-block; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; }
.badge-green { background: #28a745; color: white; }
.badge-amber { background: #ffc107; color: black; }
.badge-red { background: #dc3545; color: white; }
</style>
</head>
<body>
<div class="admin-panel">
<div id="login-page">
<h1>Admin Login</h1>
<div class="form-group">
<label>Password:</label>
<input type="password" id="password" placeholder="Enter password">
</div>
<button class="save-btn" onclick="login()">Login</button>
</div>

<div id="admin-page" style="display: none;">
<h1>Admin Dashboard <button class="logout-btn" onclick="logout()">Logout</button></h1>
<div id="status-message"></div>

<h2>üìä Project KPIs</h2>
<div class="section">
<div class="two-col">
<div class="form-group">
<label>Physical Progress (%):</label>
<input type="number" id="physicalProgress" min="0" max="100">
</div>
<div class="form-group">
<label>Financial Progress (%):</label>
<input type="number" id="financialProgress" min="0" max="100">
</div>
<div class="form-group">
<label>Total Project Cost (‚Çπ):</label>
<input type="number" id="totalCost">
</div>
<div class="form-group">
<label>Funds Released (‚Çπ):</label>
<input type="number" id="fundsReleased">
</div>
</div>
</div>

<h2>üèóÔ∏è RAG Status</h2>
<div class="section">
<div class="two-col">
<div class="form-group">
<label>Quality Status:</label>
<select id="qualityStatus">
<option value="GREEN">Green</option>
<option value="AMBER">Amber</option>
<option value="RED">Red</option>
</select>
</div>
<div class="form-group">
<label>Timeline Status:</label>
<select id="timelineStatus">
<option value="GREEN">Green</option>
<option value="AMBER">Amber</option>
<option value="RED">Red</option>
</select>
</div>
<div class="form-group">
<label>Cost Status:</label>
<select id="costStatus">
<option value="GREEN">Green</option>
<option value="AMBER">Amber</option>
<option value="RED">Red</option>
</select>
</div>
<div class="form-group">
<label>Safety Status:</label>
<select id="safetyStatus">
<option value="GREEN">Green</option>
<option value="AMBER">Amber</option>
<option value="RED">Red</option>
</select>
</div>
</div>
</div>

<h2>üè¢ Building Progress</h2>
<div class="section" id="buildingsContainer"></div>

<button class="save-btn" onclick="handleSave()">üöÄ Save All Changes to Dashboard</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>
<script>
const ADMIN_PASSWORD = 'admin123';
const BUILDINGS = ['External Development/Road', 'Junior & Senior Resident', 'Boys Hostel (G+8)', 'Nursing Girls Hostel (G+8)', 'Girls Hostel (G+6)', 'Hospital Block (B+G+7)', 'Service Block', 'Vishram Sarai (G+2)', 'Medical College (B+G+5)', 'Director & MS Residence', 'Paramedical Block (B+G+6)', 'Common Basement'];

let firebaseConfig = null;
let db = null;

function initFirebase() {
  firebaseConfig = {
    apiKey: localStorage.getItem('firebaseApiKey') || 'ENTER_YOUR_API_KEY',
    authDomain: localStorage.getItem('firebaseAuthDomain') || 'ENTER_YOUR_AUTH_DOMAIN',
    databaseURL: localStorage.getItem('firebaseDatabaseURL') || 'ENTER_YOUR_DATABASE_URL',
    projectId: localStorage.getItem('firebaseProjectId') || 'ENTER_YOUR_PROJECT_ID',
    storageBucket: localStorage.getItem('firebaseStorageBucket') || 'ENTER_YOUR_STORAGE_BUCKET',
    messagingSenderId: localStorage.getItem('firebaseMessagingSenderId') || 'ENTER_YOUR_MESSAGING_SENDER_ID',
    appId: localStorage.getItem('firebaseAppId') || 'ENTER_YOUR_APP_ID'
  };

  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.database();
    console.log('Firebase initialized successfully');
  } catch (error) {
    console.warn('Firebase not fully configured yet. Using localStorage fallback.');
  }
}

function showStatus(message, isSuccess = true) {
  const statusDiv = document.getElementById('status-message');
  statusDiv.textContent = message;
  statusDiv.className = 'status-msg ' + (isSuccess ? 'status-success' : 'status-error');
  setTimeout(() => { statusDiv.textContent = ''; statusDiv.className = ''; }, 3000);
}

function login() {
  if (document.getElementById('password').value === ADMIN_PASSWORD) {
    localStorage.setItem('adminLoggedIn', 'true');
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('admin-page').style.display = 'block';
    loadData();
  } else {
    alert('Invalid password!');
  }
}

function logout() {
  localStorage.removeItem('adminLoggedIn');
  document.getElementById('login-page').style.display = 'block';
  document.getElementById('admin-page').style.display = 'none';
  document.getElementById('password').value = '';
}

function loadData() {
  let data = JSON.parse(localStorage.getItem('dashboardData')) || {};
  
  if (db) {
    db.ref('gmcSirsa').once('value')
      .then(snapshot => {
        if (snapshot.exists()) {
          data = snapshot.val();
        }
        populateForm(data);
      })
      .catch(error => {
        console.log('Reading from Firebase failed, using localStorage', error);
        populateForm(data);
      });
  } else {
    populateForm(data);
  }
}

function populateForm(data) {
  document.getElementById('physicalProgress').value = data.physicalProgress || 26.87;
  document.getElementById('financialProgress').value = data.financialProgress || 32.15;
  document.getElementById('totalCost').value = data.totalCost || 8552;
  document.getElementById('fundsReleased').value = data.fundsReleased || 4000;
  document.getElementById('qualityStatus').value = data.qualityStatus || 'AMBER';
  document.getElementById('timelineStatus').value = data.timelineStatus || 'RED';
  document.getElementById('costStatus').value = data.costStatus || 'RED';
  document.getElementById('safetyStatus').value = data.safetyStatus || 'RED';
  renderBuildings(data.buildings || {});
}

function renderBuildings(buildings) {
  const container = document.getElementById('buildingsContainer');
  container.innerHTML = '';
  BUILDINGS.forEach(building => {
    const div = document.createElement('div');
    div.className = 'form-group';
    const input = document.createElement('input');
    input.type = 'number';
    input.min = '0';
    input.max = '100';
    input.value = buildings[building] || '0';
    input.id = 'building_' + building;
    const label = document.createElement('label');
    label.textContent = building + ' (%)';
    div.appendChild(label);
    div.appendChild(input);
    container.appendChild(div);
  });
}

function handleSave() {
  const saveBtn = event.target;
  saveBtn.disabled = true;
  saveBtn.textContent = 'üíæ Saving...';
  
  const data = {
    physicalProgress: parseFloat(document.getElementById('physicalProgress').value),
    financialProgress: parseFloat(document.getElementById('financialProgress').value),
    totalCost: parseFloat(document.getElementById('totalCost').value),
    fundsReleased: parseFloat(document.getElementById('fundsReleased').value),
    qualityStatus: document.getElementById('qualityStatus').value,
    timelineStatus: document.getElementById('timelineStatus').value,
    costStatus: document.getElementById('costStatus').value,
    safetyStatus: document.getElementById('safetyStatus').value,
    buildings: {},
    lastUpdated: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
  };
  
  BUILDINGS.forEach(building => {
    data.buildings[building] = parseFloat(document.getElementById('building_' + building).value);
  });
  
  localStorage.setItem('dashboardData', JSON.stringify(data));
  
  if (db) {
    db.ref('gmcSirsa').set(data)
      .then(() => {
        showStatus('‚úì Data saved successfully to Firebase and all devices!', true);
        saveBtn.disabled = false;
        saveBtn.textContent = 'üöÄ Save All Changes to Dashboard';
      })
      .catch(error => {
        showStatus('‚úì Data saved locally (Firebase sync not configured)', true);
        console.log('Firebase write error:', error);
        saveBtn.disabled = false;
        saveBtn.textContent = 'üöÄ Save All Changes to Dashboard';
      });
  } else {
    showStatus('‚úì Data saved locally (refresh dashboard to see updates)', true);
    saveBtn.disabled = false;
    saveBtn.textContent = 'üöÄ Save All Changes to Dashboard';
  }
}

window.addEventListener('load', () => {
  initFirebase();
  if (localStorage.getItem('adminLoggedIn') === 'true') {
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('admin-page').style.display = 'block';
    loadData();
  }
});
</script>
</body>
</html>

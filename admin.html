<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMC Sirsa - Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f0f0; }
        .admin-panel { max-width: 1200px; margin: 20px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }
        .logout-btn { float: right; padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .logout-btn:hover { background: #c82333; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; color: #333; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group textarea { min-height: 100px; }
        .save-btn { padding: 12px 30px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; }
        .save-btn:hover { background: #218838; }
        .building-section { background: #f9f9f9; padding: 20px; margin-bottom: 20px; border-radius: 4px; border-left: 4px solid #007bff; }
        .building-section h3 { color: #007bff; margin-bottom: 10px; }
        .status-message { padding: 10px; margin-bottom: 10px; border-radius: 4px; display: none; }
        .status-message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .three-column { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <div class="admin-panel">
        <div id="login-page">
            <h1>Admin Login</h1>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter admin password">
            </div>
            <button class="save-btn" onclick="login()">Login</button>
        </div>
        
        <div id="admin-page" style="display: none;">
            <h1>Admin Dashboard - Real-Time Sync Enabled
                <button class="logout-btn" onclick="logout()">Logout</button>
            </h1>
            <div class="status-message" id="status-message"></div>
            
            <h2 style="color: #333; margin-top: 30px; margin-bottom: 15px;">Project Summary</h2>
            <div class="two-column">
                <div class="form-group">
                    <label>Total Project Cost (₹ Cr):</label>
                    <input type="text" id="totalProjectCost" placeholder="e.g., 832">
                </div>
                <div class="form-group">
                    <label>Financial Progress Amount (₹ Cr):</label>
                    <input type="text" id="financialProgressAmount" placeholder="e.g., 201.84">
                </div>
            </div>
            <div class="two-column">
                <div class="form-group">
                    <label>Total Funds Released (₹ Cr):</label>
                    <input type="text" id="totalFundsReleased" placeholder="e.g., 134.90">
                </div>
                <div class="form-group">
                    <label>Funding Gap (₹ Cr):</label>
                    <input type="text" id="fundingGap" placeholder="e.g., 67.10">
                </div>
            </div>
            <div class="two-column">
                <div class="form-group">
                    <label>Physical Progress (%):</label>
                    <input type="number" id="physicalProgress" placeholder="e.g., 26.87">
                </div>
                <div class="form-group">
                    <label>Financial Progress (%):</label>
                    <input type="number" id="financialProgress" placeholder="e.g., 24.26">
                </div>
            </div>
            
            <h2 style="color: #333; margin-top: 30px; margin-bottom: 15px;">RAG Status</h2>
            <div class="three-column">
                <div class="form-group">
                    <label>Quality:</label>
                    <select id="ragQuality">
                        <option>GREEN</option>
                        <option>AMBER</option>
                        <option>RED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Timeline:</label>
                    <select id="ragTimeline">
                        <option>GREEN</option>
                        <option>AMBER</option>
                        <option>RED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cost:</label>
                    <select id="ragCost">
                        <option>GREEN</option>
                        <option>AMBER</option>
                        <option>RED</option>
                    </select>
                </div>
            </div>
            <div class="form-group" style="max-width: 33.33%; display: inline-block; width: calc(33.33% - 14px); margin-right: 20px;">
                <label>Safety:</label>
                <select id="ragSafety">
                    <option>GREEN</option>
                    <option>AMBER</option>
                    <option>RED</option>
                </select>
            </div>
            
            <h2 style="color: #333; margin-top: 30px; margin-bottom: 15px;">Physical Progress by Building</h2>
            <div id="buildings-container"></div>
            
            <button class="save-btn" onclick="handleSave()" style="margin-top: 30px; margin-bottom: 30px;">Save All Changes</button>
        </div>
    </div>
    
    <script>
        const ADMIN_PASSWORD = 'admin';
          
     <div style="background: #f9f9f9; padding: 20px; margin-top: 20px; border-radius: 4px;">
     <h3>Monthly Photo Upload</h3>
     <div class="form-group">
     <label>Select Month:</label>
     <select id="photoMonth" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
     <option>November</option><option>December</option><option>January</option><option>February</option>
     <option>March</option><option>April</option><option>May</option><option>June</option>
     <option>July</option><option>August</option><option>September</option><option>October</option>
     </select>
     </div>
     <div class="form-group">
     <label>Upload Photo:</label>
     <input type="file" id="photoUpload" accept="image/*" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
     </div>
     <button onclick="uploadMonthlyPhoto()" style="padding: 12px 30px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Upload Photo</button>
     </div>

        const DATA_URL = 'https://raw.githubusercontent.com/pankajkapil/gmc-sirsa-dashboard/main/data.json';
        let currentData = null;
        
        // Buildings list with correct names
        const BUILDINGS = [
            'External Development/Road',
            'Junior & Senior Resident (S+12)',
            'Boys Hostel (G+8)',
            'Nursing Girls Hostel (G+8)',
            'Girls Hostel (G+6)',
            'Hospital Block (B+G+7)',
            'Service Block',
            'Vishram Sarai (G+2)',
            'Medical College (B+G+5)',
            'Director & MS Residence (G+1)',
            'Paramedical Block (B+G+6)',
            'Common Basement'
        ];
        
        function login() {
            const password = document.getElementById('password').value;
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                loadData();
                showAdminPanel();
            } else {
                alert('Invalid password!');
            }
        }
        
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('login-page').style.display = 'block';
            document.getElementById('admin-page').style.display = 'none';
            document.getElementById('password').value = '';
        }
        
        function showAdminPanel() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('admin-page').style.display = 'block';
            renderBuildingFields();
        }
        
        function renderBuildingFields() {
            const container = document.getElementById('buildings-container');
            container.innerHTML = '';
            BUILDINGS.forEach(building => {
                const section = document.createElement('div');
                section.className = 'building-section';
                section.innerHTML = `
                    <h3>${building}</h3>
                    <div class="form-group">
                        <label>Progress (%):</label>
                        <input type="number" class="building-progress" data-building="${building}" placeholder="0-100">
                    </div>
                `;
                container.appendChild(section);
            });
        }
        
        function loadData() {
            try {
                const savedData = localStorage.getItem('dashboardData');
                if (savedData) {
                    currentData = JSON.parse(savedData);
                    populateFields();
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
        
        function populateFields() {
            if (!currentData) return;
            
            const summary = currentData.projectSummary || {};
            const rag = currentData.ragStatus || {};
            const buildings = currentData.physicalProgress || {};
            
            document.getElementById('totalProjectCost').value = summary.totalProjectCost || '';
            document.getElementById('financialProgressAmount').value = summary.financialProgressAmount || '';
            document.getElementById('totalFundsReleased').value = summary.totalFundsReleased || '';
            document.getElementById('fundingGap').value = summary.fundingGap || '';
            document.getElementById('physicalProgress').value = summary.physicalProgress || '';
            document.getElementById('financialProgress').value = summary.financialProgress || '';
            
            document.getElementById('ragQuality').value = rag.quality || 'GREEN';
            document.getElementById('ragTimeline').value = rag.timeline || 'GREEN';
            document.getElementById('ragCost').value = rag.cost || 'GREEN';
            document.getElementById('ragSafety').value = rag.safety || 'GREEN';
            
            BUILDINGS.forEach(building => {
                const input = document.querySelector(`[data-building="${building}"]`);
                if (input) {
                    input.value = buildings[building] || '';
                }
            });
        }
        
        function handleSave() {
// Load existing data from localStorage
    const existingData = JSON.parse(localStorage.getItem('dashboardData')) || {};
    const existingProjectSummary = existingData.projectSummary || {};
    const existingRagStatus = existingData.ragStatus || {};
    
    // Get building progress from form
const existingBuildings = existingData.physicalProgress || {}; const buildings = { ...existingBuildings };
    BUILDINGS.forEach(building => {
      const input = document.querySelector(`[data-building="${building}"]`);
      if (input) {
buildings[building] = parseFloat(input.value) || existingBuildings[building] || 0;      }
    });
    
    // Update summary ONLY if values are provided in the form (not empty)
    const summary = {
      projectName: 'GMC Sirsa Medical College Construction',
      totalProjectCost: document.getElementById('totalProjectCost').value || existingProjectSummary.totalProjectCost || '',
      physicalProgress: parseFloat(document.getElementById('physicalProgress').value) || existingProjectSummary.physicalProgress || 0,
      financialProgress: parseFloat(document.getElementById('financialProgress').value) || existingProjectSummary.financialProgress || 0,
      totalFundsReleased: document.getElementById('totalFundsReleased').value || existingProjectSummary.totalFundsReleased || '',
      financialProgressAmount: document.getElementById('financialProgressAmount').value || existingProjectSummary.financialProgressAmount || '',
      fundingGap: document.getElementById('fundingGap').value || existingProjectSummary.fundingGap || ''
    };
    
    // Get RAG Status
    const rag = {
      quality: document.getElementById('ragQuality').value,
      timeline: document.getElementById('ragTimeline').value,
      cost: document.getElementById('ragCost').value,
      safety: document.getElementById('ragSafety').value
    };
    
    // Create consolidated data object
    const dataToSave = {
      projectSummary: summary,
      ragStatus: rag,
      physicalProgress: buildings,
      lastUpdated: new Date().toISOString().split('T')[0],
      updatedBy: 'Admin'
    };
    
    // Save to localStorage
    localStorage.setItem('dashboardData', JSON.stringify(dataToSave));
    currentData = dataToSave;
    
    showStatus('Data saved successfully!', 'success');
    setTimeout(() => {
      location.reload();
    }, 1500);        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            statusEl.style.display = 'block';
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 4000);
        }
        
        // Check if already logged in
        window.addEventListener('load', () => {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                loadData();
                showAdminPanel();
            }
         
 // Monthly Photo Upload Function
 function uploadMonthlyPhoto() {
   const month = document.getElementById('photoMonth').value;
   const photoInput = document.getElementById('photoUpload');
   
   if (!photoInput.files || photoInput.files.length === 0) {
     alert('Please select a photo');
     return;
   }
   
   const file = photoInput.files[0];
   const reader = new FileReader();
   
   reader.onload = function(e) {
     const photoData = e.target.result;
     const savedPhotos = JSON.parse(localStorage.getItem('monthlyPhotos')) || {};
     savedPhotos[month] = photoData;
     localStorage.setItem('monthlyPhotos', JSON.stringify(savedPhotos));
     alert(`Photo uploaded for ${month}!`);
     photoInput.value = '';
   };
   
   reader.readAsDataURL(file);
 }
        });
    </script>
</body>
</html>
